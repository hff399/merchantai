(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{2796:function(e,s,t){Promise.resolve().then(t.bind(t,4026)),Promise.resolve().then(t.t.bind(t,2972,23))},4026:function(e,s,t){"use strict";t.d(s,{default:function(){return m}});var l=t(7437),a=t(2265),r=t(9376),n=t(9064),c=t(7684),i=t(4743),d=t(9763);let o=(0,d.Z)("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);var x=t(2720);let u=(0,d.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var h=t(2489);function m(e){let{user:s}=e,t=(0,r.useRouter)(),[d,m]=(0,a.useState)(!1),[g,b]=(0,a.useState)(null),[y,p]=(0,a.useState)(!1),[f,j]=(0,a.useState)(""),[N,v]=(0,a.useState)("HTML"),[k,w]=(0,a.useState)(""),[Z,C]=(0,a.useState)(""),[P,S]=(0,a.useState)(s.tags||[]),_=async()=>{if(f.trim()){p(!0);try{let e=await fetch("/api/users/send-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegramId:s.telegram_id,message:f,parseMode:N})});if(e.ok)n.ZP.success("Сообщение отправлено"),b(null),j("");else{let s=await e.json();n.ZP.error(s.error||"Ошибка отправки")}}catch(e){n.ZP.error("Ошибка отправки")}finally{p(!1)}}},M=async()=>{let e=parseInt(k);if(e&&0!==e){p(!0);try{let l=await fetch("/api/users/give-credits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,amount:e})});if(l.ok)n.ZP.success("Начислено ".concat(e," токенов")),b(null),w(""),t.refresh();else{let e=await l.json();n.ZP.error(e.error||"Ошибка")}}catch(e){n.ZP.error("Ошибка")}finally{p(!1)}}},T=async()=>{p(!0);try{(await fetch("/api/users/toggle-block",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,block:!s.is_blocked})})).ok?(n.ZP.success(s.is_blocked?"Пользователь разблокирован":"Пользователь заблокирован"),t.refresh()):n.ZP.error("Ошибка")}catch(e){n.ZP.error("Ошибка")}finally{p(!1),m(!1)}},O=async()=>{p(!0);try{(await fetch("/api/users/update-tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,tags:P})})).ok?(n.ZP.success("Теги обновлены"),b(null),t.refresh()):n.ZP.error("Ошибка")}catch(e){n.ZP.error("Ошибка")}finally{p(!1)}},z=()=>{Z.trim()&&!P.includes(Z.trim())&&(S([...P,Z.trim()]),C(""))},H=e=>{S(P.filter(s=>s!==e))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{onClick:()=>m(!d),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,l.jsx)(c.Z,{className:"w-5 h-5 text-gray-500"})}),d&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>m(!1)}),(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20",children:[(0,l.jsxs)("button",{onClick:()=>{b("message"),m(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,l.jsx)(i.Z,{className:"w-4 h-4"}),"Отправить сообщение"]}),(0,l.jsxs)("button",{onClick:()=>{b("credits"),m(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,l.jsx)(o,{className:"w-4 h-4"}),"Начислить токены"]}),(0,l.jsxs)("button",{onClick:()=>{b("tags"),m(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,l.jsx)(x.Z,{className:"w-4 h-4"}),"Управление тегами"]}),(0,l.jsx)("hr",{className:"my-1"}),(0,l.jsxs)("button",{onClick:T,className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2 ".concat(s.is_blocked?"text-green-600":"text-red-600"),children:[(0,l.jsx)(u,{className:"w-4 h-4"}),s.is_blocked?"Разблокировать":"Заблокировать"]})]})]})]}),"message"===g&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Отправить сообщение"}),(0,l.jsx)("button",{onClick:()=>b(null),children:(0,l.jsx)(h.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Получатель: ",s.first_name||s.username||"ID: ".concat(s.telegram_id)]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Формат"}),(0,l.jsxs)("select",{value:N,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg",children:[(0,l.jsx)("option",{value:"HTML",children:"HTML"}),(0,l.jsx)("option",{value:"Markdown",children:"Markdown"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Сообщение"}),(0,l.jsx)("textarea",{value:f,onChange:e=>j(e.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-200 rounded-lg font-mono text-sm",placeholder:"HTML"===N?"<b>Жирный</b>, <i>курсив</i>, <code>код</code>":"*Жирный*, _курсив_, `код`"})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>b(null),className:"flex-1 px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:"Отмена"}),(0,l.jsx)("button",{onClick:_,disabled:y||!f.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:y?"Отправка...":"Отправить"})]})]})]})}),"credits"===g&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Начислить токены"}),(0,l.jsx)("button",{onClick:()=>b(null),children:(0,l.jsx)(h.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Текущий баланс: ",s.credits," токенов"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Количество токенов"}),(0,l.jsx)("input",{type:"number",value:k,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg",placeholder:"Введите число (можно отрицательное)"})]}),(0,l.jsx)("div",{className:"flex gap-2",children:[10,50,100,200].map(e=>(0,l.jsxs)("button",{onClick:()=>w(String(e)),className:"px-3 py-1 bg-gray-100 rounded hover:bg-gray-200 text-sm",children:["+",e]},e))}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>b(null),className:"flex-1 px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:"Отмена"}),(0,l.jsx)("button",{onClick:M,disabled:y||!k,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:y?"Сохранение...":"Начислить"})]})]})]})}),"tags"===g&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Управление тегами"}),(0,l.jsx)("button",{onClick:()=>b(null),children:(0,l.jsx)(h.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{type:"text",value:Z,onChange:e=>C(e.target.value),onKeyDown:e=>"Enter"===e.key&&z(),className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg",placeholder:"Новый тег"}),(0,l.jsx)("button",{onClick:z,className:"px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Добавить"})]}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 min-h-[60px] p-3 bg-gray-50 rounded-lg",children:0===P.length?(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"Нет тегов"}):P.map(e=>(0,l.jsxs)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-sm rounded flex items-center gap-1",children:[e,(0,l.jsx)("button",{onClick:()=>H(e),children:(0,l.jsx)(h.Z,{className:"w-3 h-3"})})]},e))}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>b(null),className:"flex-1 px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:"Отмена"}),(0,l.jsx)("button",{onClick:O,disabled:y,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:y?"Сохранение...":"Сохранить"})]})]})]})})]})}},7684:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(9763).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},4743:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(9763).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},2720:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(9763).Z)("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]])},2489:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[972,952,971,117,744],function(){return e(e.s=2796)}),_N_E=e.O()}]);