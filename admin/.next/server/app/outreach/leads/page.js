(()=>{var e={};e.id=873,e.ids=[873],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>h,tree:()=>d}),s(256),s(9256),s(5866);var a=s(3191),r=s(8716),l=s(7922),n=s.n(l),i=s(5231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(t,c);let d=["",{children:["outreach",{children:["leads",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,256)),"/Users/leomishin/merchantai/admin/app/outreach/leads/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9256)),"/Users/leomishin/merchantai/admin/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/leomishin/merchantai/admin/app/outreach/leads/page.tsx"],x="/outreach/leads/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/outreach/leads/page",pathname:"/outreach/leads",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1945:(e,t,s)=>{Promise.resolve().then(s.bind(s,4762)),Promise.resolve().then(s.t.bind(s,9404,23))},791:(e,t,s)=>{Promise.resolve().then(s.bind(s,3842)),Promise.resolve().then(s.bind(s,381))},2460:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},4762:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var a=s(326),r=s(7577),l=s(5047),n=s(381),i=s(231),c=s(617),d=s(9436),o=s(6557);let x=(0,o.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),m=(0,o.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var h=s(4019);function u({lead:e}){let t=(0,l.useRouter)(),[s,o]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1),g=async s=>{p(!0);try{(await fetch("/api/outreach/leads/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leadId:e.id,status:s})})).ok?(n.ZP.success("Статус обновлён"),t.refresh()):n.ZP.error("Ошибка")}catch(e){n.ZP.error("Ошибка")}finally{p(!1),o(!1)}},y=async()=>{p(!0);try{let s=await fetch("/api/outreach/leads/send-dm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leadId:e.id})});if(s.ok)n.ZP.success("DM отправлен"),t.refresh();else{let e=await s.json();n.ZP.error(e.error||"Ошибка")}}catch(e){n.ZP.error("Ошибка")}finally{p(!1),o(!1)}};return(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[a.jsx("button",{onClick:()=>o(!s),className:"p-2 hover:bg-gray-100 rounded-lg",disabled:u,children:a.jsx(i.Z,{className:"w-5 h-5 text-gray-500"})}),s&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>o(!1)}),(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-20",children:[e.username&&(0,a.jsxs)("a",{href:`https://t.me/${e.username}`,target:"_blank",rel:"noopener noreferrer",className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(c.Z,{className:"w-4 h-4"}),"Открыть в Telegram"]}),!e.dm_sent&&(0,a.jsxs)("button",{onClick:y,className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(d.Z,{className:"w-4 h-4"}),"Отправить DM"]}),a.jsx("hr",{className:"my-1"}),a.jsx("p",{className:"px-4 py-1 text-xs text-gray-400 uppercase",children:"Изменить статус"}),(0,a.jsxs)("button",{onClick:()=>g("contacted"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(d.Z,{className:"w-4 h-4 text-yellow-500"}),"Связались"]}),(0,a.jsxs)("button",{onClick:()=>g("replied"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(c.Z,{className:"w-4 h-4 text-green-500"}),"Ответил"]}),(0,a.jsxs)("button",{onClick:()=>g("qualified"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(x,{className:"w-4 h-4 text-purple-500"}),"Квалифицирован"]}),(0,a.jsxs)("button",{onClick:()=>g("converted"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(m,{className:"w-4 h-4 text-emerald-500"}),"Конвертирован"]}),(0,a.jsxs)("button",{onClick:()=>g("rejected"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2 text-red-600",children:[a.jsx(h.Z,{className:"w-4 h-4"}),"Отклонить"]})]})]})]})}},3842:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var a=s(326),r=s(434),l=s(5047),n=s(1135),i=s(1009),c=s(4319),d=s(4061),o=s(9436),x=s(3468),m=s(4975),h=s(617),u=s(8378);let p=[{name:"Дашборд",href:"/",icon:c.Z},{name:"Пользователи",href:"/users",icon:d.Z},{name:"Рассылки",href:"/broadcasts",icon:o.Z},{name:"Аутрич",href:"/outreach",icon:x.Z},{name:"Лиды",href:"/outreach/leads",icon:m.Z},{name:"Группы",href:"/outreach/groups",icon:h.Z}];function g(){let e=(0,l.usePathname)();return(0,a.jsxs)("div",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[a.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"MerchantAI"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Admin Panel"})]}),a.jsx("nav",{className:"flex-1 p-4 space-y-1",children:p.map(t=>{let s=e===t.href||"/"!==t.href&&e.startsWith(t.href);return(0,a.jsxs)(r.default,{href:t.href,className:function(...e){return(0,i.m6)((0,n.W)(e))}("flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",s?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[a.jsx(t.icon,{className:"w-5 h-5"}),t.name]},t.name)})}),a.jsx("div",{className:"p-4 border-t border-gray-200",children:(0,a.jsxs)(r.default,{href:"/settings",className:"flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors",children:[a.jsx(u.Z,{className:"w-5 h-5"}),"Настройки"]})})]})}},231:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(6557).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},4019:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(6557).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9256:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>c});var a=s(9510),r=s(8013),l=s.n(r);s(7272);var n=s(9125);let i=(0,s(8570).createProxy)(String.raw`/Users/leomishin/merchantai/admin/components/Sidebar.tsx#default`),c={title:"MerchantAI Admin",description:"Admin dashboard for MerchantAI Telegram Bot"};function d({children:e}){return a.jsx("html",{lang:"ru",children:(0,a.jsxs)("body",{className:l().className,children:[(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[a.jsx(i,{}),a.jsx("main",{className:"flex-1 overflow-auto",children:a.jsx("div",{className:"p-8",children:e})})]}),a.jsx(n.x7,{position:"top-right"})]})})}},256:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(9510),r=s(5662),l=s(650),n=s(7371),i=s(4359),c=s(86);let d=(0,s(6478).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),o=(0,s(8570).createProxy)(String.raw`/Users/leomishin/merchantai/admin/app/outreach/leads/LeadActions.tsx#default`);async function x(e){let t=parseInt(e.page||"1"),s=(t-1)*20,a=r.p.from("outreach_leads").select(`
      *,
      outreach_campaigns(name),
      outreach_groups(title)
    `,{count:"exact"}).order("created_at",{ascending:!1});e.status&&(a=a.eq("status",e.status));let{data:l,count:n}=await a.range(s,s+20-1);return{leads:l||[],total:n||0,page:t,totalPages:Math.ceil((n||0)/20)}}let m={new:{label:"Новый",color:"bg-blue-100 text-blue-700"},contacted:{label:"Связались",color:"bg-yellow-100 text-yellow-700"},replied:{label:"Ответил",color:"bg-green-100 text-green-700"},qualified:{label:"Квалифицирован",color:"bg-purple-100 text-purple-700"},converted:{label:"Конвертирован",color:"bg-emerald-100 text-emerald-700"},rejected:{label:"Отклонён",color:"bg-red-100 text-red-700"}};async function h({searchParams:e}){let{leads:t,total:s,page:r,totalPages:h}=await x(e);return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Лиды"}),(0,a.jsxs)("p",{className:"text-gray-500",children:["Всего: ",s]})]})}),a.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[a.jsx(n.default,{href:"/outreach/leads",className:`px-3 py-1 rounded-full text-sm ${e.status?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-gray-900 text-white"}`,children:"Все"}),Object.entries(m).map(([t,s])=>a.jsx(n.default,{href:`/outreach/leads?status=${t}`,className:`px-3 py-1 rounded-full text-sm ${e.status===t?"bg-gray-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.label},t))]})}),a.jsx("div",{className:"bg-white rounded-xl border border-gray-200",children:0===t.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[a.jsx(i.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Нет лидов"}),a.jsx("p",{className:"text-gray-500",children:"Лиды появятся когда люди начнут отвечать на ваши объявления"})]}):a.jsx("div",{className:"divide-y divide-gray-100",children:t.map(e=>{let t=m[e.status];return a.jsx("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0",children:a.jsx("span",{className:"text-gray-600 font-medium text-lg",children:(e.first_name||e.username||"?")[0].toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900",children:[e.first_name||"Без имени",e.last_name&&` ${e.last_name}`]}),e.username&&(0,a.jsxs)("a",{href:`https://t.me/${e.username}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1 text-sm",children:["@",e.username,a.jsx(c.Z,{className:"w-3 h-3"})]}),a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t.color}`,children:t.label})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mb-2",children:["Кампания: ",e.outreach_campaigns?.name||"-"," \xb7 Группа: ",e.outreach_groups?.title||"-"]}),e.initial_message&&a.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-2",children:a.jsx("p",{className:"text-sm text-gray-700",children:e.initial_message})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:[a.jsx("span",{children:(0,l.SY)(e.created_at)}),e.dm_sent&&(0,a.jsxs)("span",{className:"flex items-center gap-1 text-green-600",children:[a.jsx(d,{className:"w-3 h-3"}),"DM отправлен"]})]})]}),a.jsx(o,{lead:e})]})},e.id)})})}),h>1&&(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[r>1&&a.jsx(n.default,{href:`/outreach/leads?page=${r-1}${e.status?`&status=${e.status}`:""}`,className:"px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:"Назад"}),(0,a.jsxs)("span",{className:"px-4 py-2 text-gray-600",children:["Страница ",r," из ",h]}),r<h&&a.jsx(n.default,{href:`/outreach/leads?page=${r+1}${e.status?`&status=${e.status}`:""}`,className:"px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:"Вперёд"})]})]})}},5662:(e,t,s)=>{"use strict";s.d(t,{p:()=>a});let a=(0,s(7857).eI)("https://lfeqwqcbhjkedclxihlw.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},650:(e,t,s)=>{"use strict";s.d(t,{SY:()=>i,p6:()=>n,uf:()=>d,xG:()=>c});var a=s(3597),r=s(4269),l=s(6611);function n(e){return(0,a.Z)(new Date(e),"dd.MM.yyyy HH:mm",{locale:l.Z})}function i(e){return(0,r.Z)(new Date(e),{addSuffix:!0,locale:l.Z})}function c(e,t="RUB"){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function d(e){return new Intl.NumberFormat("ru-RU").format(e)}},86:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(6478).Z)("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]])},4359:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(6478).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},7371:(e,t,s)=>{"use strict";s.d(t,{default:()=>r.a});var a=s(1812),r=s.n(a)},1812:(e,t,s)=>{"use strict";let{createProxy:a}=s(8570);e.exports=a("/Users/leomishin/merchantai/admin/node_modules/next/dist/client/link.js")},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,857,223,377],()=>s(9121));module.exports=a})();